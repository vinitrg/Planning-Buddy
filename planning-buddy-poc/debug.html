<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Planning Buddy POC</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; border-left: 4px solid #007cba; }
        button { padding: 10px 20px; margin: 10px 0; font-size: 16px; }
    </style>
</head>
<body>
    <h1>Debug - Planning Buddy</h1>
    
    <div class="debug" id="debug-log">
        <h3>Debug Log:</h3>
        <div id="log-content">Loading...</div>
    </div>
    
    <button id="authorize-button" style="display: none;">Sign In with Google</button>
    <button id="signout-button" style="display: none;">Sign Out</button>
    
    <div id="status"></div>

    <script src="config.js"></script>
    <script>
        const log = document.getElementById('log-content');
        
        function debugLog(message) {
            console.log(message);
            log.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
        }
        
        debugLog('Page loaded, checking config...');
        debugLog('CLIENT_ID: ' + (CONFIG.CLIENT_ID ? 'Present' : 'Missing'));
        debugLog('API_KEY: ' + (CONFIG.API_KEY ? 'Present' : 'Missing'));
        
        let gapiInited = false;
        let gisInited = false;
        
        function gapiLoaded() {
            debugLog('GAPI library loaded');
            gapi.load('client', initializeGapiClient);
        }
        
        async function initializeGapiClient() {
            debugLog('Initializing GAPI client...');
            try {
                await gapi.client.init({
                    apiKey: CONFIG.API_KEY,
                    discoveryDocs: CONFIG.DISCOVERY_DOCS,
                });
                gapiInited = true;
                debugLog('GAPI client initialized successfully');
                maybeEnableButtons();
            } catch (error) {
                debugLog('GAPI initialization failed: ' + error.message);
            }
        }
        
        function gisLoaded() {
            debugLog('GIS library loaded');
            gisInited = true;
            maybeEnableButtons();
        }
        
        function maybeEnableButtons() {
            debugLog(`Checking if buttons can be enabled: GAPI=${gapiInited}, GIS=${gisInited}`);
            if (gapiInited && gisInited) {
                debugLog('Enabling Sign In button');
                document.getElementById('authorize-button').style.display = 'block';
            }
        }
        
        // Wait a few seconds to see if libraries load
        setTimeout(() => {
            if (!gapiInited) debugLog('WARNING: GAPI not loaded after 3 seconds');
            if (!gisInited) debugLog('WARNING: GIS not loaded after 3 seconds');
        }, 3000);
    </script>
    
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>